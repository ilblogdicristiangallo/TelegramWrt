#!/bin/sh
# Plugin /restart_wan for TelegramWrt
# Restart the router's WAN interface, with existence check

LOG="/var/log/wan_control.log"
TIME=$(date '+%Y-%m-%d %H:%M:%S')

# Check if WAN interface exists
uci show network.wan > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "[$TIME] ‚ùå Unable to restart WAN interface (not found)" >> "$LOG"
    echo "‚ùå Unable to restart WAN interface."
    exit 1
fi

echo "üîÑ Restarting WAN interface..."

ifdown wan && ifup wan

if [ $? -eq 0 ]; then
    echo "[$TIME] ‚úÖ WAN interface restarted successfully" >> "$LOG"
    echo "‚úÖ WAN interface restarted successfully."
else
    echo "[$TIME] ‚ö†Ô∏è Error restarting WAN interface" >> "$LOG"
    echo "‚ö†Ô∏è Error restarting WAN interface."
fi

exit 0

