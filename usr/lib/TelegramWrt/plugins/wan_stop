#!/bin/sh
# Plugin /wan_stop for TelegramWrt
# Disable the router's WAN interface, with existence check

LOG="/var/log/wan_control.log"
TIME=$(date '+%Y-%m-%d %H:%M:%S')

# Check if WAN interface exists
uci show network.wan > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "[$TIME] ‚ùå Unable to disable WAN interface (not found)" >> "$LOG"
    echo "‚ùå Unable to disable WAN interface."
    exit 1
fi

echo "üõë Stopping WAN interface..."

ifdown wan

if [ $? -eq 0 ]; then
    echo "[$TIME] ‚úÖ WAN interface disabled successfully" >> "$LOG"
    echo "‚úÖ WAN interface disabled successfully."
else
    echo "[$TIME] ‚ö†Ô∏è Error disabling WAN interface" >> "$LOG"
    echo "‚ö†Ô∏è Error disabling WAN interface."
fi

exit 0

