#!/bin/sh

WHITELIST="/usr/lib/TelegramWrt/mac_whitelist.txt"
LEASES="/tmp/dhcp.leases"

echo "üîê MAC Watch ‚Äì Unauthorized Devices:"
echo ""

if [ ! -f "$WHITELIST" ]; then
  echo "‚ö†Ô∏è Whitelist file not found: $WHITELIST"
  exit 1
fi

if [ ! -f "$LEASES" ]; then
  echo "‚ö†Ô∏è DHCP lease file not found: $LEASES"
  exit 1
fi

awk '{print $2}' "$LEASES" | while read MAC; do
  if ! grep -iq "$MAC" "$WHITELIST"; then
    echo "‚ùå Unauthorized MAC detected: $MAC"
  fi
done
